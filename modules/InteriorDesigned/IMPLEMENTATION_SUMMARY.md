# 添心室內裝修設計 - 數位工具開發總結 (Implementation Summary)

## 專案概況
本文件彙整「添心室內裝修設計」所有數位工具的開發細節、技術架構與功能說明。目前專案包含三大核心模組，旨在透過網頁技術提升室內設計的規劃效率、現場管理與客戶溝通體驗。

**文件最後更新**：2025-12-08
**最新版本**：
- LayoutPlanner: v9.1 (Auto-save & Crash Prevention)
- Site Report Generator: v11.1 (Multi-page Support)
- Floorplan Scanner: v1.0.24

---

## 1. 互動式室內設計規劃工具 (LayoutPlanner)
**檔案**：`LayoutPlanner.html`, `LayoutPlanner.js`
**版本**：v9.1

### 1.1 核心功能詳解 (Features Guide)

#### A. 檔案管理與安全 (File System)
- **專案儲存/載入**：
  - 支援將當前設計儲存為 `.json` 格式，包含所有家具、繪圖區域與底圖設定。
  - **自動備份 (Auto-save)**：每 **60秒** 自動將狀態寫入瀏覽器 `localStorage`。若偵測到異常關閉，重啟時會自動詢問是否還原。
- **打包下載 (One-Click Zip)** (v9.1 新增)：
  - 一鍵下載包含 `設計圖.png`、`佈局檔.json`、`預算表.csv` 的 ZIP 壓縮包，方便歸檔或 Email 寄送。

#### B. 智慧排版與互動 (Layout & Interaction)
- **家具配置**：
  - **拖放 (Drag & Drop)**：直覺拖曳，支援自動吸附格線 (每格 50px)。
  - **智慧碰撞偵測**：移動或調整尺寸時，若物件重疊會顯示 **紅色警示框 (`border: 2px solid red`)**。
  - **方向性拉伸**：具備 **N/S/E/W** 四向獨立拉伸控點，調整尺寸時中心點會自動補償位移。
  - **鍵盤微調**：使用 `↑↓←→` 鍵進行 1px 精確移動，按住 `Shift` 則加速為 10px。
- **編輯功能**：
  - **旋轉 (Rotation)**：按 `R` 鍵或點擊面板按鈕，每次順時針旋轉 90 度。
  - **複製 (Duplicate)**：按 `Ctrl + D` 快速複製選取物件。
  - **復原/重做**：完整的 History Stack 支援 (`Ctrl + Z` / `Ctrl + Y`)。

#### C. 專業繪圖工具 (Drawing Tools)
- **多功能繪圖**：
  - **天花板 (Ceiling)**：紫色半透明填充，預設計算單價 $3,400/坪。
  - **地板 (Floor)**：橘色半透明填充，預設計算單價 $3,950/坪 (含損耗)。
- **自動化計算**：
  - **坪數換算**：自動計算多邊形面積並除以 30000 (一坪 = 180cm x 180cm 會計算較小的值當損耗)，採無條件進位。
  - **損耗加成**：地板坪數自動乘以 **1.2 倍** 並進位至 0.5 坪，確保備料充足。
- **操作邏輯**：點擊畫布新增頂點 -> 按 `Enter` 自動封口填色 -> 按 `Esc` 取消。

#### D. 動態計價引擎 (Smart Quotation)
- **即時連動**：右側面板的價格會隨物件尺寸 (`CurrentWidth`) 動態變化。
- **計價模式**：
  - `Fixed`: 固定單價 (如：沙發)。
  - `Width`: 按尺計價 (如：系統櫃 $XXXX 元/尺)。
  - `Area`: 按才數或面積計價。
- **報表輸出**：
  - **PDF 報價單**：自動排版生成 A4 報價單，包含各項小計。
  - **CSV 匯出**：可匯入 Excel 進行更細部的編輯。

---

### 1.2 操作使用手冊 (User Manual - Step-by-Step)

本節專為初學者設計，請依序閱讀以掌握基本操作。

#### 步驟 0：基礎操作與熱鍵
在開始之前，請先熟悉以下不可或缺的快速鍵，能讓您的效率提升 3 倍：
| 按鍵組合 | 功能說明 |
| :--- | :--- |
| **滑鼠左鍵** | 拖曳物件、調整尺寸 |
| **Ctrl + 滾輪** | 縮放畫布 (Zoom In/Out) |
| **Shift + 拖曳** | (無此功能，僅按Shift+方向鍵可加速移動) |
| **Ctrl + Z** | **復原** (救命鍵，回上一步) |
| **Ctrl + Y** | 重做 (取消復原) |
| **Ctrl + D** | **複製** 選取的家具 |
| **Delete** | 刪除選取的家具或區域 |
| **R** | 旋轉家具 (Rotate) |
| **Enter** | 完成繪圖 (封口) |
| **Esc** | 取消繪圖 / 取消選取 |

#### 步驟 1：匯入平面圖 (底圖校正)
這是最重要的一步！如果底圖比例不對，後續估價都會錯誤。
1. **上傳**：點擊左側「設定」頁籤 -> 「上傳底圖」。
   - *注意：若底圖歪斜，請先使用「照片轉正工具」進行校正。*
   - *注意：本網頁僅支援有正確比例之圖面 (如 CAD 檔或建商平面圖)，以確保規劃準確。*
2. **啟用調整模式**：勾選「底圖調整模式」 (Check box)。
3. **校正比例**：
   - **找門框**：依一般製圖規則，房門寬度預設為 **90cm** (除非特殊規格)。
   - **拖入量尺**：從左側元件庫拖入「**比例尺 90CM**」。
   - **調整**：將比例尺放置於圖面房門旁，拖曳「底圖縮放」滑桿，直到**房門寬度等於比例尺長度**。
4. **鎖定**：調整完畢後，**務必取消勾選**「底圖調整模式」，以免操作時誤觸底圖。

#### 步驟 2：配置家具與櫃體
**注意**：此步驟包含「系統櫃」與「一般家具」。
1. **選擇**：在左側「元件庫」選擇您要的家具 (如：客廳 -> L型沙發)。
   - *提示：家具類項目無法直接精確計價，系統預設會先以此類項目單價 $0 計算，僅供配置參考。櫃體類則會依尺數計算。*
2. **拖放**：直接拖曳到畫布上。
3. **調整尺寸**：
   - 點擊家具，出現各種顏色的控點。
   - **白色圓點**：調整長寬。
   - **紅色外框？**：代表重疊了！請移開一點直到紅框消失。
4. **精準設定**：如果不方便用滑鼠拉，可以直接在右上角「屬性面板」輸入長寬數值 (cm)。

#### 步驟 3：繪製裝修區域 (天花/地板)
1. **開始**：點擊「設定」頁籤 -> 「繪製天花板」或「繪製地板」。
2. **描點**：沿著房間角落點擊 (可稍微超出牆壁沒關係)。
3. **完成**：畫完最後一點後，按 **Enter** 鍵，系統會自動填色並顯示坪數。
4. **微調**：點擊畫好的色塊，可以看到白色的頂點，拖曳它們可以修正形狀。

#### 步驟 3.5：輸入施工面積 (保護工程)
1. **設定**：在右側「預算 & 估價」面板中，找到「施工面積 (坪)」欄位。
2. **輸入**：手動輸入室內總坪數。
3. **計算**：系統將依此數值自動計算「保護工程」的費用。

#### 步驟 4：輸出與分享
- **給客戶看圖**：點擊「另存圖片」，會下載一張乾淨的 JPG (含浮水印)。
- **給客戶報價**：點擊下方「檢視預算明細」 -> 「儲存為 PDF」。
- **備份檔案**：點擊「下載設計檔案(ZIP)」，這會把所有東西打包，建議每個案子做完都下載一份留底。

---

### 1.3 常見問題排除 (Troubleshooting & FAQ)
- **Q: 為什麼我的畫布無法捲動到右邊？**
  - A: 請嘗試按住 `Ctrl` 縮小一點，系統會自動調整邊距 (v9.2 更新)。
- **Q: 為什麼有些家具不能調整大小？**
  - A: 部分家具 (如馬桶、標準門片) 設定為 `Fixed` 尺寸，不開放調整以符合人體工學。
- **Q: 重新整理網頁後東西都不見了？**
  - A: 別擔心！系統有自動備份。請重新整理一次，並留意畫面跳出的「是否還原？」提示窗，按確定即可。
- **Q: 圖片上傳後很模糊？**
  - A: 請確認原圖解析度。若使用 Line 傳輸圖片，請務必選擇「原始畫質」下載後再上傳。
- **Q: 匯出的圖片字體太小？**
  - A: 瀏覽器的縮放比例會影響匯出結果。請嘗試將瀏覽器縮放回 100% (`Ctrl + 0`) 後再進行匯出。
- **Q: 手機上可以使用嗎？**
  - A: `LayoutPlanner` 專為桌面版瀏覽器 (Chrome/Edge) 設計，手機版建議僅用來瀏覽 `site-report` 報表。

---

## 2. 施工日誌生成器 (Site Report Generator)
**檔案**：`site-report.html`
**版本**：v11.1

### 2.1 核心功能
輕量化的手機端網頁工具，無須後端資料庫，完全在瀏覽器內執行。
- **版型演算**：
  - 1張圖：滿版顯示。
  - 2張圖：上下對半。
  - 3張圖：上1下2 (強調主圖)。
  - 4張圖：田字型排列。
  - 5-6張圖：自動分割版面。
- **自動分頁**：上傳超過 4 張照片時，自動生成 "Page 1 of 2", "Page 2 of 2" 的多張報表。
- **品牌浮水印**：自動壓印「添心室內裝修設計」Logo 與日期資訊。

---

## 3. 照片轉正工具 (Floorplan Scanner)
**檔案**：`floorplan-straightener.html`
**版本**：v1.0.24

### 3.1 核心技術
利用 OpenCV.js 進行圖像透視變換 (Perspective Transformation)。
- **操作流程**：上傳歪斜照片 -> 拖曳四個紅點對齊紙張角落 -> 點擊「校正」-> 下載修正後的平面圖。
- **放大鏡功能**：拖曳頂點時，左上角會出現局部放大視窗，方便精準對齊像素。
